(function(e){"function"==typeof bootstrap?bootstrap("promise",e):"object"==typeof exports?e(void 0,exports):"function"==typeof define?define(e):"undefined"!=typeof ses?ses.ok()&&(ses.makeQ=function(){return e(void 0,{})}):e(void 0,Q={})})(function(e,t){function n(e,t){t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(I)&&(e.stack=r(e.stack)+"\n"+I+"\n"+r(t.stack))}function r(e){for(var e=e.split("\n"),t=[],n=0;n<e.length;++n){var r=e[n],i;if(i=/at .+ \((.*):(\d+):\d+\)/.exec(r)){var s=i[2];i=i[1]===x&&s>=S&&s<=X}else i=!1;!i&&-1===r.indexOf("(module.js:")&&-1===r.indexOf("(node.js:")&&t.push(r)}return t.join("\n")}function i(){if(Error.captureStackTrace){var e,t,n=Error.prepareStackTrace;return Error.prepareStackTrace=function(n,r){e=r[1].getFileName(),t=r[1].getLineNumber()},Error().stack,Error.prepareStackTrace=n,x=e,t}}function s(e,t,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+n+" instead.",Error("").stack),e.apply(e,arguments)}}function o(){function e(e){t&&(r=p(e),_(t,function(e,t){C(function(){r.promiseDispatch.apply(r,t)})},void 0),n=t=void 0)}var t=[],n=[],r,i=H(o.prototype),s=H(u.prototype);return s.promiseDispatch=function(e,i,s){var o=M(arguments);t?(t.push(o),"when"===i&&s[1]&&n.push(s[1])):C(function(){r.promiseDispatch.apply(r,o)})},s.valueOf=function(){return t?s:r.valueOf()},Error.captureStackTrace&&(Error.captureStackTrace(s,o),s.stack=s.stack.substring(s.stack.indexOf("\n")+1)),N(s),i.promise=s,i.resolve=e,i.reject=function(t){e(h(t))},i.notify=function(e){t&&_(n,function(t,n){C(function(){n(e)})},void 0)},i}function u(e,t,n,r){void 0===t&&(t=function(e){return h(Error("Promise does not support operation: "+e))});var i=H(u.prototype);return i.promiseDispatch=function(n,r,s){var o;try{o=e[r]?e[r].apply(i,s):t.call(i,r,s)}catch(u){o=h(u)}n&&n(o)},n&&(i.valueOf=n),r&&(i.exception=r),N(i),i}function a(e){return f(e)?e.valueOf():e}function f(e){return e&&"function"==typeof e.promiseDispatch}function l(e){return!f(a(e))}function c(e){return e=a(e),f(e)&&"exception"in e}function h(e){var e=e||Error(),t=u({when:function(t){if(t){var n=D(q,this);-1!==n&&(R.splice(n,1),q.splice(n,1))}return t?t(e):h(e)}},function(){return h(e)},function(){return this},e);return!U&&"undefined"!=typeof window&&!window.Touch&&window.console&&console.log("Should be empty:",R),U=!0,q.push(t),R.push(e),t}function p(e){if(f(e))return e;if((e=a(e))&&"function"==typeof e.then){var t=o();return e.then(t.resolve,t.reject,t.notify),t.promise}return u({when:function(){return e},get:function(t){return e[t]},put:function(t,n){return e[t]=n,e},del:function(t){return delete e[t],e},post:function(t,n){return e[t].apply(e,n)},apply:function(t){return e.apply(void 0,t)},keys:function(){return B(e)}},void 0,function(){return e})}function d(e,t,r,i){function s(e){try{return t?t(e):e}catch(n){return h(n)}}function u(e){if(r){n(e,l);try{return r(e)}catch(t){return h(t)}}return h(e)}var a=o(),f=!1,l=p(e);return C(function(){l.promiseDispatch(function(e){f||(f=!0,a.resolve(s(e)))},"when",[function(e){f||(f=!0,a.resolve(u(e)))}])}),l.promiseDispatch(void 0,"when",[void 0,function(e){a.notify(i?i(e):e)}]),a.promise}function v(e,t,n){return d(e,function(e){return b(e).then(function(e){return t.apply(void 0,e)},n)},n)}function m(e,t,n){var r=o();return C(function(){p(e).promiseDispatch(r.resolve,t,n)}),r.promise}function g(e){return function(t){var n=M(arguments,1);return m(t,e,n)}}function y(e){var t=M(arguments,1);return W(e,t)}function b(e){return d(e,function(e){var t=e.length;if(0===t)return p(e);var n=o();return _(e,function(r,i,s){l(i)?(e[s]=a(i),0===--t&&n.resolve(e)):d(i,function(r){e[s]=r,0===--t&&n.resolve(e)}).fail(n.reject)},void 0),n.promise})}function w(e,t){return d(e,void 0,t)}function E(e,t){var n=M(arguments,2),r=o();return n.push(r.makeNodeResolver()),z(e,t,n).fail(r.reject),r.promise}var S=i(),x,T=function(){},N=Object.freeze||T;"undefined"!=typeof cajaVM&&(N=cajaVM.def);var C;if("undefined"!=typeof process)C=process.nextTick;else if("function"==typeof setImmediate)C=setImmediate;else if("undefined"!=typeof MessageChannel){var k=new MessageChannel,L={},A=L;k.port1.onmessage=function(){L=L.next;var e=L.task;delete L.task,e()},C=function(e){A=A.next={task:e},k.port2.postMessage(0)}}else C=function(e){setTimeout(e,0)};var O;Function.prototype.bind?(O=Function.prototype.bind,O=O.bind(O.call)):O=function(e){return function(){return e.call.apply(e,arguments)}};var M=O(Array.prototype.slice),_=O(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(arguments.length===1)do{if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}while(1);for(;n<r;n++)n in this&&(t=e(t,this[n],n));return t}),D=O(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),P=O(Array.prototype.map||function(e,t){var n=this,r=[];return _(n,function(i,s,o){r.push(e.call(t,s,o,n))},void 0),r}),H=Object.create||function(e){function t(){}return t.prototype=e,new t},B=Object.keys||function(e){var t=[],n;for(n in e)t.push(n);return t},j=Object.prototype.toString,F;F="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var I="From previous event:";t.nextTick=C,t.defer=o,o.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(M(arguments,1)):e.resolve(n)}},t.promise=function(e){var t=o();return y(e,t.resolve,t.reject,t.notify).fail(t.reject),t.promise},t.makePromise=u,u.prototype.then=function(e,t,n){return d(this,e,t,n)},u.prototype.thenResolve=function(e){return d(this,function(){return e})},_("isResolved isFulfilled isRejected dispatch when spread get put del post send invoke keys fapply fcall fbind all allResolved timeout delay catch finally fail fin progress end done nfcall nfapply nfbind ncall napply nbind npost nsend ninvoke nend nodeify".split(" "),function(e,n){u.prototype[n]=function(){return t[n].apply(t,[this].concat(M(arguments)))}},void 0),u.prototype.toSource=function(){return this.toString()},u.prototype.toString=function(){return"[object Promise]"},N(u.prototype),t.nearer=a,t.isPromise=f,t.isResolved=function(e){return l(e)||c(e)},t.isFulfilled=l,t.isRejected=c;var q=[],R=[],U;t.reject=h,t.resolve=p,t.master=function(e){return u({isDef:function(){}},function(t,n){return m(e,t,n)},function(){return a(e)})},t.when=d,t.spread=v,t.async=function(e){return function(){function t(e,t){var s;try{s=n[e](t)}catch(o){return j(o)==="[object StopIteration]"||o instanceof F?o.value:h(o)}return d(s,r,i)}var n=e.apply(this,arguments),r=t.bind(t,"send"),i=t.bind(t,"throw");return r()}},t["return"]=function(e){throw new F(e)},t.promised=function(e){return function(){return v([this,b(arguments)],function(t,n){return e.apply(t,n)})}},t.dispatch=m,t.dispatcher=g,t.get=g("get"),t.put=g("put"),t["delete"]=t.del=g("del");var z=t.post=g("post");t.send=function(e,t){var n=M(arguments,2);return z(e,t,n)},t.invoke=s(t.send,"invoke","send");var W=t.fapply=g("apply");t["try"]=y,t.fcall=y,t.fbind=function(e){var t=M(arguments,1);return function(){var n=t.concat(M(arguments));return W(e,n)}},t.keys=g("keys"),t.all=b,t.allResolved=function(e){return d(e,function(e){return d(b(P(e,function(e){return d(e,T,T)})),function(){return P(e,p)})})},t["catch"]=t.fail=w,t.progress=function(e,t){return d(e,void 0,void 0,t)},t["finally"]=t.fin=function(e,t){return d(e,function(e){return d(t(),function(){return e})},function(e){return d(t(),function(){return h(e)})})},t.done=function(e,r,i,s){r=r||i||s?d(e,r,i,s):e,w(r,function(r){C(function(){n(r,e);if(!t.onerror)throw r;t.onerror(r)})})},t.timeout=function(e,t){var n=o(),r=setTimeout(function(){n.reject(Error("Timed out after "+t+" ms"))},t);return d(e,function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)}),n.promise},t.delay=function(e,t){t===void 0&&(t=e,e=void 0);var n=o();return setTimeout(function(){n.resolve(e)},t),n.promise},t.nfapply=function(e,t){var n=M(t),r=o();return n.push(r.makeNodeResolver()),W(e,n).fail(r.reject),r.promise},t.nfcall=function(e){var t=M(arguments,1),n=o();return t.push(n.makeNodeResolver()),W(e,t).fail(n.reject),n.promise},t.nfbind=function(e){var t=M(arguments,1);return function(){var n=t.concat(M(arguments)),r=o();return n.push(r.makeNodeResolver()),W(e,n).fail(r.reject),r.promise}},t.npost=function(e,t,n){var n=M(n),r=o();return n.push(r.makeNodeResolver()),z(e,t,n).fail(r.reject),r.promise},t.nsend=E,t.ninvoke=s(E,"ninvoke","nsend"),t.nodeify=function(e,t){if(!t)return e;e.then(function(e){C(function(){t(null,e)})},function(e){C(function(){t(e)})})};var X=i()}),function(e,t,n,r){"use strict";var i="qoopido",s="base",o=function(){return[].push.apply(arguments,[t,n,r]),t[i]=t[i]||{},t[i][s]=e.apply(null,arguments)};typeof define=="function"&&define.amd?define(o):o()}(function(e,t,n){"use strict";var r=!!(Object.getOwnPropertyNames&&Array.prototype.forEach&&Object.getOwnPropertyDescriptor);return Object.create===n&&(Object.create=function(e,t){var r;if(e===null)r={__proto__:null};else{if(typeof e!="object")throw new TypeError("typeof prototype["+typeof e+'] != "object"');var i=function(){};i.prototype=e,r=new i,r.__proto__=e}return t!==n&&Object.defineProperties(r,t),r}),Object.getOwnPropertyDescriptors===n&&(Object.getOwnPropertyDescriptors=function(e){var t={};return Object.getOwnPropertyNames(e).forEach(function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)}),t}),{create:function(){var t=Object.create(this);return t._constructor&&t._constructor.apply(t,arguments),t.create=t.extend=n,t},extend:function(t){t=t||{},t._parent=this;if(r===!0)return Object.create(this,Object.getOwnPropertyDescriptors(t));var n=Object.create(this),i;for(i in t)i!=="__proto__"&&(n[i]=t[i]);return Object.create(n)}}},window,document),function(e,t,n,r){"use strict";var i="qoopido",s="unique",o=function(){return[].push.apply(arguments,[t,n,r]),t[i]=t[i]||{},t[i][s]=e.apply(null,arguments)};typeof define=="function"&&define.amd?define(["./base"],o):o(t[i].base)}(function(e,t,n,r){"use strict";function l(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})}function c(e){e=parseInt(e,10)||12,i="";for(u=0;u<e;u++)i+=f[parseInt(Math.random()*(f.length-1),10)];return i}var i,s,o,u,a={uuid:{},string:{}},f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");return e.extend({uuid:function(){do i=l();while(typeof a.uuid[i]!="undefined");return a.uuid[i]=!0,i},string:function(t){do i=c(t);while(typeof a.string[i]!="undefined");return a.string[i]=!0,i}})},window,document),function(e,t,n,r){"use strict";var i="qoopido",s="support",o=function(){return[].push.apply(arguments,[t,n,r]),t[i]=t[i]||{},t[i][s]=e.apply(null,arguments)};typeof define=="function"&&define.amd?define(["./base","q"],o):o(t[i].base,t.Q)}(function(e,t,n,r,i){"use strict";function u(){return arguments.length>1?arguments[1].toUpperCase():arguments[0].charAt(0).toUpperCase()+arguments[0].slice(1)}var s=/-([a-z])/gi,o={prefix:null,property:{},method:{},element:{},promises:{prefix:null,property:{},method:{},test:{}}};return e.extend({test:{},testMultiple:function(){var n,r=[],s=0;for(s;(n=arguments[s])!==i;s++)switch(typeof n){case"string":r.push(this.test[n]());break;case"boolean":var o=t.defer();n?o.resolve():o.reject(),r.push(o.promise);break;default:r.push(n)}return t.all(r)},getElement:function(t,n){var i=o.element[t]=o.element[t]||t!=="image"?r.createElement(t):new Image;return n=!!n,n?i.cloneNode(!1):i},getPrefix:function(){var t,n=o.prefix||null;if(n===null){var r=this.getElement("div").style,i=/^(Moz|WebKit|Khtml|ms|O|Icab)(?=[A-Z])/;n=!1;for(t in r)i.test(t)&&(n=t.match(i)[0]);n===!1&&"WebkitOpacity"in r&&(n="WebKit"),n===!1&&"KhtmlOpacity"in r&&(n="Khtml"),n=o.prefix=n===!1?!1:{method:n,properties:[n.toLowerCase(),u(n.toLowerCase())]}}return n},getProperty:function(t){t=t.replace(s,u);var n=o.property[t]||null;if(n===null){n=!1;var r,a=0,f=this.getElement("div"),l=u(t),c=(this.getPrefix()||{properties:[]}).properties,h=(t+" "+c.join(l+" ")+l).split(" ");for(a;(r=h[a])!==i;a++)if(f.style[r]!==i){n=r;break}o.property[t]=n}return n},getMethod:function(t,r){r=r||n;var s=r.tagName,a=o.method[s]=o.method[s]||{},f=a[t]=o.method[s][t]||null;if(f===null){f=!1;var l,c,h=0,p=u(t),d=this.getPrefix();d!==!1?l=(t+" "+d.method+p+" "+d.properties.join(p+" ")+p).split(" "):l=[t];for(h;(c=l[h])!==i;h++)if(r[c]!==i&&(typeof r[c]=="function"||typeof r[c]=="object")){f=c;break}o.method[s][t]=f}return f},supportsPrefix:function(){return!!this.getPrefix()},supportsProperty:function(t){return!!this.getProperty(t)},supportsMethod:function(t,n){return!!this.getMethod(t,n)},testPrefix:function(){var n=o.promises.prefix;if(n===null){var r=t.defer(),i=this.getPrefix();i?r.resolve(i):r.reject(),n=o.promises.prefix=r.promise}return n},testProperty:function(n){var r=o.promises.property[n]||null;if(r===null){var i=t.defer(),s=this.getProperty(n);s?i.resolve(s):i.reject(),r=o.promises.property[n]=i.promise}return r},testMethod:function(r,i){i=i||n;var s=i.tagName,u=o.promises.method[s]=o.promises.method[s]||{},a=u[r]=o.promises.method[s][r]||null;if(a===null){var f=t.defer(),l=this.getMethod(r,i);l?f.resolve(l):f.reject(),a=o.promises.method[s][r]=f.promise}return a},addTest:function(n,r){return this.test[n]=function(){var e=o.promises.test[n]||null;if(e===null){var i=t.defer(),s=Array.prototype.slice.call(arguments);s.splice(0,0,i),r.apply(null,s),e=o.promises.test[n]=i.promise}return e}}})},window,document),function(e,t,n,r){"use strict";var i="qoopido",s="support/capability/datauri",o=function(){return[].push.apply(arguments,[t,n,r]),t[i]=t[i]||{},t[i][s]=e.apply(null,arguments)};typeof define=="function"&&define.amd?define(["../../support"],o):o(t[i].support)}(function(e,t,n,r){"use strict";return e.addTest("/capability/datauri",function(t){var n=e.getElement("image");n.onerror=function(){t.reject()},n.onload=function(){n.width===1&&n.height===1?t.resolve():t.reject()},n.src="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="})},window,document),function(e,t,n,r){"use strict";var i="qoopido",s="support/element/canvas",o=function(){return[].push.apply(arguments,[t,n,r]),t[i]=t[i]||{},t[i][s]=e.apply(null,arguments)};typeof define=="function"&&define.amd?define(["../../support"],o):o(t[i].support)}(function(e,t,n,r){"use strict";return e.addTest("/element/canvas",function(t){var n=e.getElement("canvas");n.getContext&&n.getContext("2d")?t.resolve():t.reject()})},window,document),function(e,t,n,r){"use strict";var i="qoopido",s="support/element/canvas/todataurl",o=function(){return[].push.apply(arguments,[t,n,r]),t[i]=t[i]||{},t[i][s]=e.apply(null,arguments)};typeof define=="function"&&define.amd?define(["../../../support","../canvas"],o):o(t[i].support,t[i]["support/element/canvas"])}(function(e,t,n,r,i){"use strict";return e.addTest("/element/canvas/todataurl",function(n){t().then(function(){e.getElement("canvas").toDataURL!==i?n.resolve():n.reject()}).fail(function(){n.reject()})})},window,document),function(e,t,n,r){"use strict";var i="qoopido",s="support/element/canvas/todataurl/png",o=function(){return[].push.apply(arguments,[t,n,r]),t[i]=t[i]||{},t[i][s]=e.apply(null,arguments)};typeof define=="function"&&define.amd?define(["../../../../support","../todataurl"],o):o(t[i].support,t[i]["support/element/canvas/todataurl"])}(function(e,t,n,r,i){"use strict";return e.addTest("/element/canvas/todataurl/png",function(n){t().then(function(){e.getElement("canvas").toDataURL("image/png").indexOf("data:image/png")===0?n.resolve():n.reject()}).fail(function(){n.reject()})})},window,document),function(e,t,n,r){"use strict";var i="qoopido",s="jquery/plugins/shrinkimage",o=function(){return[].push.apply(arguments,[t,n,r]),t[i]=t[i]||{},t[i][s]=e.apply(null,arguments)};typeof define=="function"&&define.amd?define(["jquery","../../base","../../unique","../../support","../../support/capability/datauri","../../support/element/canvas/todataurl/png"],o):o(t.jQuery,t[i].base,t[i].unique,t[i].support,r,r)}(function(e,t,n,r,i,s,o,u,a){"use strict";var f="shrinkimage",l={attribute:"data-"+f,quality:80,debug:!1},c={},h=o.location.hostname,p={test:new RegExp('^url(\\x28"{0,1}|)data:image/shrink,(.+?)("{0,1}\\x29|)$',"i"),path:new RegExp('^(?:url\\x28"{0,1}|)(?:data:image/shrink,|)(.+?)(?:"{0,1}\\x29|)$',"i"),hostname:new RegExp("^\\w+://([^/]+)","i")},d=e("<a />"),v,m,g="requested."+f,y="queued."+f,b="cached."+f,w="loaded."+f,E="load";return e.fn[f]=function(t){return t=e.extend({},l,t||{}),this.each(function(){var n=e(this),i=n.attr(t.attribute),s=n.css("background-image");this.tagName==="IMG"&&r.testMultiple("/capability/datauri","/element/canvas/todataurl/png").then(function(){t.debug===!1?m.create(t,n,i):n.attr("src",i).removeAttr(t.attribute)}).fail(function(){n.attr("src",i).removeAttr(t.attribute)}),s!=="none"&&p.test.test(s)===!0&&r.testMultiple("/capability/datauri","/element/canvas/todataurl/png").then(function(){t.debug===!1?m.create(t,n,s,!0):n.css("background-image","url("+p.path.exec(s)[1]+")")}).fail(function(){n.css("background-image","url("+p.path.exec(s)[1]+")")})})},v=function(n,r){return e("<img />").attr(n,r).on(E,function(e){e.stopPropagation()})},m=t.extend({_constructor:function(t,n,r,i){var s=this;s._loader=null,s._settings=e.extend({},l,t||{}),s._target=n.css({visibility:"hidden",opacity:0}),s._background=i||!1,s._result=null,s._url=r||!1,s._parameter={quality:s._getParameter("quality",s._url)||s._settings.quality,source:s._url!==!1?p.path.exec(s._resolveUrl(s._url))[1].split("?")[0]:!1,target:s._getParameter("target",s._url)||!1};if(s._url!==!1){s._parameter.target===!1&&(s._parameter.target=s._parameter.source.replace(/\.png$/i,".q"+s._parameter.quality+".shrunk")),s._target.removeAttr(s._settings.attribute);switch(typeof c[s._parameter.target]){case"object":c[s._parameter.target]._target.one(b,function(e){e.namespace===f&&s._assign(!0)}),s._target.trigger(y,[s._parameter.target]);break;case"string":s._assign(!0);break;default:s._loader=v(t.attribute,r),c[s._parameter.target]=s,s._load(),s._target.trigger(g,[s._parameter.target])}}},_load:function(){var t=this,r=h!==p.hostname.exec(t._parameter.target)[1];e.ajax({url:r===!0?t._parameter.target+".jsonp":t._parameter.target,context:t,data:{source:t._parameter.source,quality:t._parameter.quality},global:!1,cache:!0,crossDomain:r||null,dataType:r===!0?"jsonp":"json",jsonpCallback:r===!0?f+"-"+n.string():null}).fail(function(e,n,r){t._fallback()}).done(function(e,n,r){typeof e!="object"||e.width===a||e.height===a||e.size===a||e.main===a||e.alpha===a?t._fallback():(t._result={original:parseInt(e.size,10),compressed:parseInt(r.getResponseHeader("Content-Length"),10)},t._process(e))})},_fallback:function(){var e=this;c[e._parameter.target]=e._parameter.source,e._assign(!1,!0)},_process:function(t){var n=this;n._loader.one(E,function(){var r=u.createElement("canvas"),i=n._loader.get(0),s;r.style.display="none",r.width=t.width,r.height=t.height,s=r.getContext("2d"),s.clearRect(0,0,t.width,t.height),s.drawImage(i,0,0,t.width,t.height),n._loader.one(E,function(){n._loader.remove(),s.globalCompositeOperation="xor",s.drawImage(i,0,0,t.width,t.height),c[n._parameter.target]=r.toDataURL("image/png"),e(r).remove(),n._assign()}).attr("src",t.alpha)}).attr("src",t.main)},_assign:function(e,t){var n=this;n._background===!1?n._target.one(E,function(){n._target.css({visibility:"",opacity:""}).trigger(w,[n._parameter.target,e||!1,t||!1])}).attr("src",c[n._parameter.target]):n._target.css({"background-image":"url("+c[n._parameter.target]+")"}).trigger(w,[n._parameter.target,e||!1,t||!1]),e!==!0&&n._result!==null&&n._target.trigger(b,[n._parameter.target,n._result.compressed,n._result.original])},_resolveUrl:function(e){return d.attr("href",e).prop("href")},_getParameter:function(e,t){return decodeURIComponent(((new RegExp("[?|&]"+e+"="+"([^&;]+?)(&|#|;|$)")).exec(t)||["",""])[1].replace(/\+/g,"%20"))||null}}),m},window,document);